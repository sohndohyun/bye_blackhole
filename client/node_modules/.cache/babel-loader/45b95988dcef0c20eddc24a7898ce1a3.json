{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sohndohyun/works/transcendence/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/sohndohyun/works/transcendence/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/sohndohyun/works/transcendence/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import ChatInput from'./ChatInput';import ChatLog from'./ChatLog';import Loading from'./Loading';import UserList from'./UserList';import SideBar from'../SideBar/SideBar';import'./styles/Chat.scss';import setting from'../Images/setting.png';import ChatSettingModal from'./ChatSettingModal';import axios from'axios';import useSwr from'swr';import Game from'../Pong/Game';import socket from'../Pong/PongSocket';import GameResult from'../Lobby/GameResult';import MatchFailedModal from'../Lobby/MatchFailedModal';import DirectGameModal from'../SideBar/DirectGameModal';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var socketIOClient=require('socket.io-client');var aname='a';var bname='b';var dr=0;var sbool=false;var lbool=false;var name;var Chat=function Chat(){var currentSocket=socketIOClient('http://localhost:8080');var _useState=useState(''),_useState2=_slicedToArray(_useState,2),MyID=_useState2[0],setMyID=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),roomName=_useState4[0],setRoomName=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),MyPermission=_useState6[0],setMyPermission=_useState6[1];var fetcher=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(url){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!roomName){_context.next=6;break;}_context.next=3;return axios.get(url);case 3:res=_context.sent;res.data.users=userSorting(res.data.users);return _context.abrupt(\"return\",res.data);case 6:case\"end\":return _context.stop();}}},_callee);}));return function fetcher(_x){return _ref.apply(this,arguments);};}();var _useSwr=useSwr('/Chat/info?title='+roomName,fetcher),data=_useSwr.data,error=_useSwr.error,mutate=_useSwr.mutate;function userSorting(userList){var rtn=[];var admin=[];var user=[];for(var i=0;i<userList.length;i++){if(userList[i].id===MyID)setMyPermission(userList[i].permission);if(userList[i].permission==='owner')rtn.push(userList[i]);else if(userList[i].permission==='admin')admin.push(userList[i]);else user.push(userList[i]);}admin.forEach(function(ele){return rtn.push(ele);});user.forEach(function(ele){return rtn.push(ele);});return rtn;}useEffect(function(){//setCurrentSocket(socketIOClient());\nvar id=sessionStorage.getItem('nickname');var room=sessionStorage.getItem('roomName');if(id)setMyID(id);if(room)setRoomName(room);var gameTarget=sessionStorage.getItem('directGame');if(gameTarget){setDirectGameTarget(gameTarget);openDirectGameModal();sessionStorage.removeItem('directGame');}});var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),connected=_useState8[0],setConnected=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),matched=_useState10[0],setMatched=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),MatchFailed=_useState12[0],setMatchFailed=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),DirectGameTarget=_useState14[0],setDirectGameTarget=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),gameResult=_useState16[0],setGameResult=_useState16[1];useEffect(function(){if(connected&&MyID){socket.emit('Con',MyID);}socket.emit('GameList');},[connected,MyID]);useEffect(function(){socket.on('connect',function(){setConnected(true);});socket.on('disconnect',function(){setConnected(false);});socket.on('match_failed',function(){setMatchFailed(true);});socket.on('matched',function(e){aname=e.a;bname=e.b;dr=e.dr;sbool=e.speed;lbool=e.ladder;setMatched(true);});socket.on('finish',function(e){name=e===0?aname:bname;setMatched(false);setGameResult(true);});});//gameresult modal\nvar closeGameResult=function closeGameResult(){return setGameResult(false);};//direct game modal\nvar _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),DirectGameModalState=_useState18[0],setDirectGameModalState=_useState18[1];var openDirectGameModal=function openDirectGameModal(){setDirectGameModalState(true);};var closeDirectGameModal=function closeDirectGameModal(){setDirectGameModalState(false);};//match failed modal\nvar closeMatchFailedModal=function closeMatchFailedModal(){setMatchFailed(false);if(DirectGameModalState)closeDirectGameModal();};var myInfo={roomName:roomName,userName:MyID};if(currentSocket){currentSocket.on('connect',function(){currentSocket.emit('join',myInfo);});}//chat owner modal\nvar _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),ChatSettingModalState=_useState20[0],setChatSettingModalState=_useState20[1];var openChatSettingModal=function openChatSettingModal(){setChatSettingModalState(true);};var closeChatSettingModal=function closeChatSettingModal(){setChatSettingModalState(false);};return matched?/*#__PURE__*/_jsxs(\"div\",{id:\"App-Container\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"App-Left\",children:/*#__PURE__*/_jsx(Game,{a:aname,b:bname,dr:dr,speed:sbool,ladder:lbool})}),/*#__PURE__*/_jsx(\"span\",{className:\"App-Right\",children:/*#__PURE__*/_jsx(SideBar,{})}),/*#__PURE__*/_jsx(MatchFailedModal,{open:MatchFailed,close:closeMatchFailedModal})]}):/*#__PURE__*/_jsx(\"div\",{id:\"App-Container\",children:currentSocket?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"App-Left\",children:/*#__PURE__*/_jsxs(\"div\",{id:\"chat-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-top\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"RoomInfo-num\",children:data===null||data===void 0?void 0:data.num}),/*#__PURE__*/_jsx(\"span\",{children:roomName}),MyPermission==='owner'||MyPermission==='admin'?/*#__PURE__*/_jsx(\"button\",{className:\"setting-btn\",onClick:openChatSettingModal,children:/*#__PURE__*/_jsx(\"img\",{src:setting,width:\"30\",height:\"30\"})}):null]}),/*#__PURE__*/_jsx(ChatSettingModal,{open:ChatSettingModalState,close:closeChatSettingModal,chatRoomID:roomName,MyPermission:MyPermission}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-bottom\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"left-chatLog\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"chatLog-top\",children:/*#__PURE__*/_jsx(ChatLog,{socket:currentSocket,MyID:MyID,roomName:roomName})}),/*#__PURE__*/_jsx(\"div\",{className:\"chatLog-bottom\",children:/*#__PURE__*/_jsx(ChatInput,{socket:currentSocket,MyPermission:MyPermission})})]}),/*#__PURE__*/_jsx(\"span\",{className:\"right-chatUser\",children:/*#__PURE__*/_jsx(UserList,{socket:currentSocket,users:data===null||data===void 0?void 0:data.users,MyPermission:MyPermission,getRoomInfoMutate:mutate,roomName:roomName})})]})]})}),/*#__PURE__*/_jsx(\"span\",{className:\"App-Right\",children:/*#__PURE__*/_jsx(SideBar,{})}),/*#__PURE__*/_jsx(GameResult,{name:name,open:gameResult,close:closeGameResult}),/*#__PURE__*/_jsx(DirectGameModal,{open:DirectGameModalState,close:closeDirectGameModal,targetID:DirectGameTarget,closeUserInfoModal:null}),/*#__PURE__*/_jsx(MatchFailedModal,{open:MatchFailed,close:closeMatchFailedModal})]}):/*#__PURE__*/_jsx(Loading,{})});};export default Chat;","map":{"version":3,"sources":["/Users/sohndohyun/works/transcendence/client/src/Chat/Chat.tsx"],"names":["React","useEffect","useState","ChatInput","ChatLog","Loading","UserList","SideBar","setting","ChatSettingModal","axios","useSwr","Game","socket","GameResult","MatchFailedModal","DirectGameModal","socketIOClient","require","aname","bname","dr","sbool","lbool","name","Chat","currentSocket","MyID","setMyID","roomName","setRoomName","MyPermission","setMyPermission","fetcher","url","get","res","data","users","userSorting","error","mutate","userList","rtn","admin","user","i","length","id","permission","push","forEach","ele","sessionStorage","getItem","room","gameTarget","setDirectGameTarget","openDirectGameModal","removeItem","connected","setConnected","matched","setMatched","MatchFailed","setMatchFailed","DirectGameTarget","gameResult","setGameResult","emit","on","e","a","b","speed","ladder","closeGameResult","DirectGameModalState","setDirectGameModalState","closeDirectGameModal","closeMatchFailedModal","myInfo","userName","ChatSettingModalState","setChatSettingModalState","openChatSettingModal","closeChatSettingModal","num"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport ChatInput from './ChatInput';\nimport ChatLog from './ChatLog';\nimport Loading from './Loading';\nimport UserList from './UserList';\nimport SideBar from '../SideBar/SideBar';\nimport './styles/Chat.scss';\nimport setting from '../Images/setting.png';\nimport ChatSettingModal from './ChatSettingModal';\nimport axios from 'axios';\nimport useSwr from 'swr';\n\nimport Game from '../Pong/Game';\nimport socket from '../Pong/PongSocket';\nimport GameResult from '../Lobby/GameResult';\nimport { MatchData } from '../Lobby/Lobby';\nimport MatchFailedModal from '../Lobby/MatchFailedModal';\nimport DirectGameModal from '../SideBar/DirectGameModal';\n\nconst socketIOClient = require('socket.io-client');\n\nlet aname = 'a';\nlet bname = 'b';\nlet dr = 0;\nlet sbool = false;\nlet lbool = false;\nlet name: string;\n\nconst Chat = () => {\n  interface Iuser {\n    id: string;\n    permission: string;\n    icon: string;\n  }\n  const currentSocket = socketIOClient('http://localhost:8080');\n  const [MyID, setMyID] = useState('');\n  const [roomName, setRoomName] = useState('');\n  const [MyPermission, setMyPermission] = useState('');\n\n  const fetcher = async (url: string) => {\n    if (roomName) {\n      const res = await axios.get(url);\n      res.data.users = userSorting(res.data.users);\n      return res.data;\n    }\n  };\n  const { data, error, mutate } = useSwr<{\n    num: string;\n    security: string;\n    users: Iuser[];\n  }>('/Chat/info?title=' + roomName, fetcher);\n\n  function userSorting(userList: Iuser[]) {\n    var rtn: Iuser[] = [];\n    var admin: Iuser[] = [];\n    var user: Iuser[] = [];\n\n    for (let i = 0; i < userList.length; i++) {\n      if (userList[i].id === MyID) setMyPermission(userList[i].permission);\n\n      if (userList[i].permission === 'owner') rtn.push(userList[i]);\n      else if (userList[i].permission === 'admin') admin.push(userList[i]);\n      else user.push(userList[i]);\n    }\n\n    admin.forEach((ele) => rtn.push(ele));\n    user.forEach((ele) => rtn.push(ele));\n    return rtn;\n  }\n\n  useEffect(() => {\n    //setCurrentSocket(socketIOClient());\n\n    const id = sessionStorage.getItem('nickname');\n    const room = sessionStorage.getItem('roomName');\n    if (id) setMyID(id);\n    if (room) setRoomName(room);\n\n    const gameTarget = sessionStorage.getItem('directGame');\n    if (gameTarget) {\n      setDirectGameTarget(gameTarget);\n      openDirectGameModal();\n      sessionStorage.removeItem('directGame');\n    }\n  });\n\n  const [connected, setConnected] = useState(false);\n  const [matched, setMatched] = useState(false);\n  const [MatchFailed, setMatchFailed] = useState(false);\n  const [DirectGameTarget, setDirectGameTarget] = useState('');\n  const [gameResult, setGameResult] = useState(false);\n\n  useEffect(() => {\n    if (connected && MyID) {\n      socket.emit('Con', MyID);\n    }\n    socket.emit('GameList');\n  }, [connected, MyID]);\n\n  useEffect(() => {\n    socket.on('connect', () => {\n      setConnected(true);\n    });\n\n    socket.on('disconnect', () => {\n      setConnected(false);\n    });\n\n    socket.on('match_failed', () => {\n      setMatchFailed(true);\n    });\n\n    socket.on('matched', (e: MatchData) => {\n      aname = e.a;\n      bname = e.b;\n      dr = e.dr;\n      sbool = e.speed;\n      lbool = e.ladder;\n      setMatched(true);\n    });\n\n    socket.on('finish', (e: number) => {\n      name = e === 0 ? aname : bname;\n      setMatched(false);\n      setGameResult(true);\n    });\n  });\n\n  //gameresult modal\n  const closeGameResult = () => setGameResult(false);\n\n  //direct game modal\n  const [DirectGameModalState, setDirectGameModalState] = useState(false);\n  const openDirectGameModal = () => {\n    setDirectGameModalState(true);\n  };\n  const closeDirectGameModal = () => {\n    setDirectGameModalState(false);\n  };\n\n  //match failed modal\n  const closeMatchFailedModal = () => {\n    setMatchFailed(false);\n    if (DirectGameModalState) closeDirectGameModal();\n  };\n\n  const myInfo = {\n    roomName: roomName,\n    userName: MyID,\n  };\n\n  if (currentSocket) {\n    currentSocket.on('connect', () => {\n      currentSocket.emit('join', myInfo);\n    });\n  }\n\n  //chat owner modal\n  const [ChatSettingModalState, setChatSettingModalState] = useState(false);\n  const openChatSettingModal = () => {\n    setChatSettingModalState(true);\n  };\n  const closeChatSettingModal = () => {\n    setChatSettingModalState(false);\n  };\n\n  return matched ? (\n    <div id=\"App-Container\">\n      <span className=\"App-Left\">\n        <Game a={aname} b={bname} dr={dr} speed={sbool} ladder={lbool} />\n      </span>\n      <span className=\"App-Right\">\n        <SideBar />\n      </span>\n      <MatchFailedModal open={MatchFailed} close={closeMatchFailedModal} />\n    </div>\n  ) : (\n    <div id=\"App-Container\">\n      {currentSocket ? (\n        <>\n          <span className=\"App-Left\">\n            <div id=\"chat-container\">\n              <div className=\"chat-top\">\n                <span className=\"RoomInfo-num\">{data?.num}</span>\n                <span>{roomName}</span>\n                {MyPermission === 'owner' || MyPermission === 'admin' ? (\n                  <button\n                    className=\"setting-btn\"\n                    onClick={openChatSettingModal}\n                  >\n                    <img src={setting} width=\"30\" height=\"30\"></img>\n                  </button>\n                ) : null}\n              </div>\n              <ChatSettingModal\n                open={ChatSettingModalState}\n                close={closeChatSettingModal}\n                chatRoomID={roomName}\n                MyPermission={MyPermission}\n              ></ChatSettingModal>\n              <div className=\"chat-bottom\">\n                <span className=\"left-chatLog\">\n                  <div className=\"chatLog-top\">\n                    <ChatLog\n                      socket={currentSocket}\n                      MyID={MyID}\n                      roomName={roomName}\n                    />\n                  </div>\n                  <div className=\"chatLog-bottom\">\n                    <ChatInput\n                      socket={currentSocket}\n                      MyPermission={MyPermission}\n                    />\n                  </div>\n                </span>\n                <span className=\"right-chatUser\">\n                  <UserList\n                    socket={currentSocket}\n                    users={data?.users}\n                    MyPermission={MyPermission}\n                    getRoomInfoMutate={mutate}\n                    roomName={roomName}\n                  ></UserList>\n                </span>\n              </div>\n            </div>\n          </span>\n          <span className=\"App-Right\">\n            <SideBar />\n          </span>\n          <GameResult name={name} open={gameResult} close={closeGameResult} />\n          <DirectGameModal\n            open={DirectGameModalState}\n            close={closeDirectGameModal}\n            targetID={DirectGameTarget}\n            closeUserInfoModal={null}\n          />\n          <MatchFailedModal open={MatchFailed} close={closeMatchFailedModal} />\n        </>\n      ) : (\n        <Loading></Loading>\n      )}\n    </div>\n  );\n};\n\nexport default Chat;\n"]},"metadata":{},"sourceType":"module"}